"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react");function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=e(t);const a={},o=(t,e,n,o)=>{const{debug:c}=a[t];c&&((t,e,n)=>{console[t]("::SMART-CONTEXT::DEBUG:: ".concat(e),n)})(e,n,o)},c=(t,e)=>n=>"object"!=typeof n&&"RESET"!==t?(o(e,"error","Invalid action call. Payload must be an object",{contextName:e,type:t,payload:n}),null):a[e].dispatch({type:t,payload:n,contextName:e}),r=(t,e)=>{const n={},r={},i={};return Object.keys(t).forEach((a=>{const o=a.replace(/([a-z0-9])([A-Z])/g,"$1_$2").toUpperCase();const s=t[a];var l;"function"==typeof s?(n[o]={handler:s},r[a]=c(o,e)):(l=s,Array.isArray(l)&&l.every((t=>"string"==typeof t))?(n[o]={keys:s},r[a]=c(o,e)):i[a]=s)})),n.RESET={keys:[]},r.reset=c("RESET",e),Object.keys(i).length&&o(e,"error","Invalid actions found in config. They are ignored.",{contextName:e,inValidActions:i}),a[e].actionTypes=n,{actions:r}},i=(t,e)=>{const{type:n,payload:c,contextName:r}=e,{actionTypes:i,getInitialState:s}=a[r];if("RESET"===n)return s();const l={},d={};return i[n].keys.forEach((e=>{e in c?l[e]=c[e]:(l[e]=t[e],d[n]={payload:c,contextName:r}),Object.keys(d).length&&o(r,"warn","Unknown keys in action payload are ignored",{contextName:r,ignoredKeys:d})})),{...t,...l}},s=({actionsConfig:t={},initialState:e={},debug:n=!1,displayName:c})=>{a[c]={getInitialState:()=>JSON.parse(JSON.stringify(e)),debug:n};const{actions:s}=r(t,c),{reducer:l,initialState:d}=(t=>({reducer:(e,n)=>{try{const{type:c}=n,{actionTypes:r}=a[t],s=(r[c].handler||i)(e,n);return o(t,"log","Action Dispatch Success",{contextName:t,action:n,newState:s}),s}catch(a){return o(t,"error","Action Dispatch Failed",{contextName:t,action:n,error:{message:"Error in reducer. Check action config and dispatch call."}}),e}},initialState:a[t].getInitialState()}))(c);return{contextName:c,actions:s,reducer:l,initialState:d}};exports.getContext=t=>a[t]?a[t].context:{error:"Context ".concat(t," not found")},exports.initContext=(e={})=>{const{displayName:o}=e,c=(t=>"string"!=typeof t||""===t?"Context name not valid: ".concat(t):!!a[t]&&"Context already initialized: ".concat(t))(o);if(c)return c;const{contextName:r,actions:i,reducer:l,initialState:d}=s(e),y=t.createContext({});y.displayName=r,(t=>{const{displayName:e}=t;a[e].context=t})(y);return({children:e})=>{const[o,c]=t.useReducer(l,d);t.useEffect((()=>{((t,e)=>{a[t].dispatch=e})(r,c)}),[]);const s={state:o,actions:i};return n.default.createElement(y.Provider,{value:s},e)}};
